<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><title>Calibrate Feeder - Fish Feeder</title><link rel="stylesheet" href="css/styles.css"><style>.calibration-card{background:#fff;border:2px solid #176d87;border-radius:4px;margin:24px 0;padding:24px}.calibration-header{font-size:1.5em;font-weight:700;color:#176d87;margin-bottom:20px}.calibration-info{background:#e6f2f5;padding:16px;border-radius:4px;margin-bottom:24px;line-height:1.6}.calibration-info p{margin:8px 0}.calibration-status{display:flex;gap:32px;margin-bottom:32px;flex-wrap:wrap}.status-item{display:flex;align-items:center;gap:8px;font-size:1.1em}.status-item .label{font-weight:700;color:#176d87}.status-item .value{background:#176d87;color:#fff;padding:4px 12px;border-radius:4px;font-weight:700;min-width:60px;text-align:center}.calibration-controls{margin-bottom:24px}.control-group{margin-bottom:24px}.control-group label{display:block;font-weight:700;color:#176d87;margin-bottom:12px;font-size:1.1em}.button-row{display:flex;gap:12px;flex-wrap:wrap}.btn{border:none;border-radius:4px;padding:12px 24px;font-size:1.1em;cursor:pointer;transition:all .2s;font-weight:700}.btn-adjust{background:#176d87;color:#fff;min-width:80px}.btn-adjust:hover{background:#124e63}.btn-adjust:active{transform:scale(.95)}.btn-adjust:disabled{background:#ccc;cursor:not-allowed}.btn-test{background:#28a745;color:#fff;min-width:120px}.btn-test:hover{background:#218838}.btn-test:active{transform:scale(.95)}.btn-save{background:#007bff;color:#fff;min-width:120px}.btn-save:hover{background:#0056b3}.btn-save:active{transform:scale(.95)}.action-buttons{display:flex;gap:16px;margin-top:32px}.message{margin-top:24px;padding:16px;border-radius:4px;display:none;font-weight:700}.message.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;display:block}.message.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;display:block}</style></head><body><div class="header"><div class="header-content"><div class="header-logo"><img src="assets/images/Header.png" alt="Fish Feeder Logo"></div><div class="header-title"><h1>Keep your Fish full</h1></div></div></div><div style="display:flex"><div class="sidebar"><b>Quick Links</b><br><a href="index.html" class="quick-link">Home</a> <a href="setschedule.html" class="quick-link">Set Feeding Schedule</a> <a href="feednow.html" class="quick-link">Feed Now !!!</a> <a href="setquantity.html" class="quick-link">Set Quantity</a> <a href="calibration.html" class="quick-link active">Calibrate Feeder</a> <a href="troubleshooting.html" class="quick-link">Troubleshooting</a></div><div style="flex:1;padding:16px"><div class="calibration-card"><div class="calibration-header">Calibrate Feeder</div><div class="calibration-info"><p>Use this page to calibrate your feeder. If the disk is not disbursing complete food, then press "&lt;" button, otherwise press "&gt;" button. To calibrate faster, you can use the "&lt;&lt;" or "&gt;&gt;" buttons.</p><p>After adjusting, press "Test" button few times to verify the calibration.</p><p>Once calibration is completed, press "Save" button to save the calibration settings.</p></div><div class="calibration-status"><div class="status-item"><span class="label">Current Duty Cycle:</span> <span class="value" id="duty-cycle-value">Loading...</span></div><div class="status-item"><span class="label">Current Pulse Duration:</span> <span class="value" id="pulse-duration-value">Loading...</span> ms</div></div><div class="calibration-controls"><div class="control-group"><label>Adjust Duty Cycle:</label><div class="button-row"><button class="btn btn-adjust" id="duty-decrease-large">&lt;&lt;</button> <button class="btn btn-adjust" id="duty-decrease">&lt;</button> <button class="btn btn-adjust" id="duty-increase">&gt;</button> <button class="btn btn-adjust" id="duty-increase-large">&gt;&gt;</button></div></div><div class="control-group"><label>Adjust Pulse Duration:</label><div class="button-row"><button class="btn btn-adjust" id="duration-decrease">&lt;</button> <button class="btn btn-adjust" id="duration-increase">&gt;</button></div></div><div class="action-buttons"><button class="btn btn-test" id="test-btn">Test</button> <button class="btn btn-save" id="save-btn">Save</button></div></div><div class="message" id="message"></div></div></div></div><script>let API_BASE="",dutyCycleDisplay,pulseDurationDisplay,messageDiv,dutyDecreaseLargeBtn,dutyDecreaseBtn,dutyIncreaseBtn,dutyIncreaseLargeBtn,durationDecreaseBtn,durationIncreaseBtn,testBtn,saveBtn;async function loadCalibration(){try{var e=await fetch(API_BASE+"/api/calibration/get");if(!e.ok)throw new Error("Failed to load calibration");var t=await e.json();dutyCycleDisplay.textContent=t.duty_cycle,pulseDurationDisplay.textContent=t.pulse_duration}catch(e){console.error("Error loading calibration:",e),showMessage("Error loading calibration values","error")}}async function adjustDutyCycle(e){disableAllButtons();try{var t=await fetch(API_BASE+"/api/calibration/adjust_duty",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({increment:e})});if(!t.ok)throw new Error("Failed to adjust duty cycle");var a=await t.json();dutyCycleDisplay.textContent=a.duty_cycle,pulseDurationDisplay.textContent=a.pulse_duration,showMessage("Duty cycle adjusted to "+a.duty_cycle,"success")}catch(e){console.error("Error adjusting duty cycle:",e),showMessage("Error adjusting duty cycle","error")}finally{enableAllButtons()}}async function adjustPulseDuration(e){disableAllButtons();try{var t=await fetch(API_BASE+"/api/calibration/adjust_duration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({increment:e})});if(!t.ok)throw new Error("Failed to adjust pulse duration");var a=await t.json();dutyCycleDisplay.textContent=a.duty_cycle,pulseDurationDisplay.textContent=a.pulse_duration,showMessage(`Pulse duration adjusted to ${a.pulse_duration}ms`,"success")}catch(e){console.error("Error adjusting pulse duration:",e),showMessage("Error adjusting pulse duration","error")}finally{enableAllButtons()}}async function testCalibration(){disableAllButtons(),testBtn.textContent="Testing...";try{var e=await fetch(API_BASE+"/api/calibration/test",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to test calibration");var t=await e.json();t.success?showMessage(`Test successful! Duty: ${t.duty_cycle}, Duration: ${t.pulse_duration}ms`,"success"):showMessage("Test failed: "+(t.error||"Unknown error"),"error")}catch(e){console.error("Error testing calibration:",e),showMessage("Error testing calibration","error")}finally{testBtn.textContent="Test",enableAllButtons()}}async function saveCalibration(){disableAllButtons(),saveBtn.textContent="Saving...";try{var e=parseInt(dutyCycleDisplay.textContent),t=parseInt(pulseDurationDisplay.textContent),a=await fetch(API_BASE+"/api/calibration/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({duty_cycle:e,pulse_duration:t})});if(!a.ok)throw new Error("Failed to save calibration");var n=await a.json();showMessage(`Calibration saved successfully! Duty: ${n.duty_cycle}, Duration: ${n.pulse_duration}ms`,"success")}catch(e){console.error("Error saving calibration:",e),showMessage("Error saving calibration","error")}finally{saveBtn.textContent="Save",enableAllButtons()}}function showMessage(e,t){messageDiv.textContent=e,messageDiv.className="message "+t,messageDiv.style.display="block","success"===t&&setTimeout(()=>{messageDiv.style.display="none"},3e3)}function disableAllButtons(){dutyDecreaseLargeBtn.disabled=!0,dutyDecreaseBtn.disabled=!0,dutyIncreaseBtn.disabled=!0,dutyIncreaseLargeBtn.disabled=!0,durationDecreaseBtn.disabled=!0,durationIncreaseBtn.disabled=!0,testBtn.disabled=!0,saveBtn.disabled=!0}function enableAllButtons(){dutyDecreaseLargeBtn.disabled=!1,dutyDecreaseBtn.disabled=!1,dutyIncreaseBtn.disabled=!1,dutyIncreaseLargeBtn.disabled=!1,durationDecreaseBtn.disabled=!1,durationIncreaseBtn.disabled=!1,testBtn.disabled=!1,saveBtn.disabled=!1}document.addEventListener("DOMContentLoaded",function(){dutyCycleDisplay=document.getElementById("duty-cycle-value"),pulseDurationDisplay=document.getElementById("pulse-duration-value"),messageDiv=document.getElementById("message"),dutyDecreaseLargeBtn=document.getElementById("duty-decrease-large"),dutyDecreaseBtn=document.getElementById("duty-decrease"),dutyIncreaseBtn=document.getElementById("duty-increase"),dutyIncreaseLargeBtn=document.getElementById("duty-increase-large"),durationDecreaseBtn=document.getElementById("duration-decrease"),durationIncreaseBtn=document.getElementById("duration-increase"),testBtn=document.getElementById("test-btn"),saveBtn=document.getElementById("save-btn"),dutyDecreaseLargeBtn.addEventListener("click",()=>adjustDutyCycle(10)),dutyDecreaseBtn.addEventListener("click",()=>adjustDutyCycle(1)),dutyIncreaseBtn.addEventListener("click",()=>adjustDutyCycle(-1)),dutyIncreaseLargeBtn.addEventListener("click",()=>adjustDutyCycle(-10)),durationDecreaseBtn.addEventListener("click",()=>adjustPulseDuration(-5)),durationIncreaseBtn.addEventListener("click",()=>adjustPulseDuration(5)),testBtn.addEventListener("click",testCalibration),saveBtn.addEventListener("click",saveCalibration),loadCalibration()})</script></body></html>