<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Set Feeding Schedule</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <script>
    // Helper: Map day names to checkbox IDs
    const dayMap = {
      "Monday": "mon",
      "Tuesday": "tue",
      "Wednesday": "wed",
      "Thursday": "thu",
      "Friday": "fri",
      "Saturday": "sat",
      "Sunday": "sun"
    };

    // Load schedule data from backend and bind to UI
    window.addEventListener('DOMContentLoaded', function() {
  fetch('http://localhost:5000/api/schedule')
        .then(r => r.json())
        .then(data => {
          if (!data.feeding_times || !data.days) return;
          data.feeding_times.forEach((ft, i) => {
            document.getElementById(`ft${i+1}_chk`).checked = ft.enabled;
            document.getElementById(`ft${i+1}_hr`).value = ft.hour;
            document.getElementById(`ft${i+1}_min`).value = ft.minute;
            document.getElementById(`ft${i+1}_ampm`).value = ft.ampm;
          });
          Object.keys(data.days).forEach(day => {
            const id = dayMap[day];
            if (id) document.getElementById(id).checked = data.days[day];
          });
        });
      // Save handler
      document.querySelector('form').addEventListener('submit', function(e) {
        e.preventDefault();
        // Collect feeding times
        const feeding_times = [1,2,3].map(i => ({
          enabled: document.getElementById(`ft${i}_chk`).checked,
          hour: parseInt(document.getElementById(`ft${i}_hr`).value) || 0,
          minute: parseInt(document.getElementById(`ft${i}_min`).value) || 0,
          ampm: document.getElementById(`ft${i}_ampm`).value || "AM"
        }));
        // Collect days
        const days = {};
        Object.keys(dayMap).forEach(day => {
          days[day] = document.getElementById(dayMap[day]).checked;
        });
        // Send to backend
  fetch('http://localhost:5000/api/schedule', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ feeding_times, days })
        }).then(r => r.json()).then(resp => {
          if (resp.status === 'ok') alert('Schedule saved!');
          else alert('Error saving schedule');
        });
      });
    });
  </script>
  <div class="header">
    <div class="header-content">
      <div class="header-logo">
        <img src="assets/images/Header.png" alt="Fish Feeder Logo">
      </div>
      <div class="header-title">
        <h1>Keep your Fish full</h1>
      </div>
    </div>
  </div>
  <div style="display:flex;">
      <div class="sidebar">
        <b>Quick Links</b><br>
        <a href="index.html" class="quick-link">Home</a>
        <a href="setschedule.html" class="quick-link">Set Feeding Schedule</a>
        <a href="feednow.html" class="quick-link">Feed Now !!!</a>
        <a href="setquantity.html" class="quick-link">Set Quantity</a>
      </div>
    <div style="flex:1; padding:16px;">
      <div class="card">
        <div style="background:#17688a; color:#fff; padding:8px; font-weight:bold;">Set Feeding Schedule</div>
        <form>
          <div style="margin-top:12px;">
            <div style="margin-bottom:8px; display:flex; align-items:center;">
              <label style="margin-right:8px;"><input type="checkbox" id="ft1_chk"> Feeding Time 1 :</label>
              <select id="ft1_hr" style="margin-right:4px;">
                <option value="">Hr</option>
                <script>for(let i=1;i<=12;i++)document.write(`<option value='${i}'>${i}</option>`);</script>
              </select>
              <select id="ft1_min" style="margin-right:4px;">
                <option value="">Min</option>
                <option value="0">00</option>
                <option value="15">15</option>
                <option value="30">30</option>
                <option value="45">45</option>
              </select>
              <select id="ft1_ampm">
                <option value="">AM/PM</option>
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
            <div style="margin-bottom:8px; display:flex; align-items:center;">
              <label style="margin-right:8px;"><input type="checkbox" id="ft2_chk"> Feeding Time 2 :</label>
              <select id="ft2_hr" style="margin-right:4px;">
                <option value="">Hr</option>
                <script>for(let i=1;i<=12;i++)document.write(`<option value='${i}'>${i}</option>`);</script>
              </select>
              <select id="ft2_min" style="margin-right:4px;">
                <option value="">Min</option>
                <option value="0">00</option>
                <option value="15">15</option>
                <option value="30">30</option>
                <option value="45">45</option>
              </select>
              <select id="ft2_ampm">
                <option value="">AM/PM</option>
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
            <div style="margin-bottom:8px; display:flex; align-items:center;">
              <label style="margin-right:8px;"><input type="checkbox" id="ft3_chk"> Feeding Time 3 :</label>
              <select id="ft3_hr" style="margin-right:4px;">
                <option value="">Hr</option>
                <script>for(let i=1;i<=12;i++)document.write(`<option value='${i}'>${i}</option>`);</script>
              </select>
              <select id="ft3_min" style="margin-right:4px;">
                <option value="">Min</option>
                <option value="0">00</option>
                <option value="15">15</option>
                <option value="30">30</option>
                <option value="45">45</option>
              </select>
              <select id="ft3_ampm">
                <option value="">AM/PM</option>
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
            <div style="padding-top:16px;"><b>Select Days:</b></div>
            <div>
              <label style="margin-right:12px;"><input type="checkbox" id="mon"> Monday</label><br/>
              <label style="margin-right:12px;"><input type="checkbox" id="tue"> Tuesday</label><br/>
              <label style="margin-right:12px;"><input type="checkbox" id="wed"> Wednesday</label><br/>
              <label style="margin-right:12px;"><input type="checkbox" id="thu"> Thursday</label><br/>
              <label style="margin-right:12px;"><input type="checkbox" id="fri"> Friday</label><br/>
              <label style="margin-right:12px;"><input type="checkbox" id="sat"> Saturday</label><br/>
              <label style="margin-right:12px;"><input type="checkbox" id="sun"> Sunday</label><br/>
            </div>
          </div>
          <div style="margin-top:16px; text-align:left;">
            <button type="submit" class="btn">Save</button>
            <button type="button" class="btn" style="background:#17688a; margin-left:8px;">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</body>
</html>
